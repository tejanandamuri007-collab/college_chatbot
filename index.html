<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>College Insight Chatbot</title>
    <!-- Load Tailwind CSS --><script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Lucide Icons for aesthetic buttons --><script src="https://unpkg.com/lucide@latest"></script>
    <!-- Load Chart.js for visualization --><script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <style>
        /* Custom styles for a modern, rounded chat interface */
        :root {
            /* --- NEW VIBRANT TEAL THEME --- */
            --primary-color: #00C9A7; /* Vibrant Teal/Cyan - Primary Accent */
            --radiant-blue-start: #00D2D3; /* Lighter Teal for Gradient Start */
            --radiant-blue-end: #006494; /* Deep Ocean Blue for Gradient End */
            --bot-bubble: #e0fff8; /* Soft Mint/Light Teal - NEW COLOR */
            --user-bubble: var(--primary-color);
            /* ---------------------------- */
        }
        
        /* --- DARK MODE VARIABLES AND BASE STYLES --- */
        .dark {
            --background-color: #121212; /* Deep Dark Background */
            --surface-color: #1f1f1f; /* Darker Surface */
            --bot-bubble: #333333; /* Darker grey for bot bubble */
            --text-color: #e0e0e0;
            --link-color: #00D2D3;
        }

        .dark body {
            background-color: var(--background-color);
            background-image: none; /* Remove bright background image in dark mode */
            color: var(--text-color);
        }

        .dark body::before {
            background-color: rgba(0, 0, 0, 0.7);
        }

        .dark body::after {
            color: rgba(0, 168, 135, 0.08); /* Fainter watermark */
        }

        .dark .card-container {
            background: linear-gradient(145deg, var(--radiant-blue-end) 0%, var(--radiant-blue-start) 100%); /* Reverse gradient for visual distinction */
            border-color: rgba(255, 255, 255, 0.1);
            box-shadow: 0 0 40px rgba(0, 201, 167, 0.3); /* Softer glow */
        }

        .dark #login-card {
            background-color: rgba(31, 31, 31, 0.95);
            border-color: rgba(255, 255, 255, 0.15);
            box-shadow: 0 10px 40px 0 rgba(0, 0, 0, 0.5);
        }

        .dark h2, .dark p, .dark .feature-item p, .dark .chat-header h1, .dark .chat-header p, .dark .graph-summary h4, .dark .graph-summary p {
            color: var(--text-color); /* Light text color for dark mode */
        }
        .dark .feature-item {
            background-color: rgba(40, 40, 40, 0.7);
            border-color: rgba(255, 255, 255, 0.1);
        }
        /* --- END DARK MODE BASE STYLES --- */

        body {
            font-family: 'Inter', sans-serif;
            /* --- UPDATED: New Background Image --- */
            background-image: url('https://i.postimg.cc/qRSBHZwg/1b6896fd-e68c-4630-9143-40d15911d44c.png');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            background-color: #2c3e50; /* Deep Charcoal Fallback */
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 1rem;
            position: relative;
            overflow: hidden;
        }

        /* Transparent overlay over the background color/image */
        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(22, 33, 44, 0.7); /* Darker, modern transparency */
            z-index: -1; /* Place it between the chat (z=1) and the text (z=-2) */
        }
        
        /* --- NEW: Branded Text Watermark in the Background --- */
        body::after {
            content: "PRAGATI ENGINEERING COLLEGE";
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-15deg); /* Center and rotate slightly */
            font-size: 8vw; /* Large, fluid size */
            font-weight: 900; /* Extra bold */
            color: rgba(0, 168, 135, 0.15); /* Darker Teal/Green, very faint */
            letter-spacing: 0.5rem;
            pointer-events: none; /* Ignore mouse events */
            z-index: -2; /* Place behind the color overlay */
            white-space: nowrap;
            /* GLOW EFFECT: Strong text shadow in the primary color */
            text-shadow: 0 0 10px rgba(0, 201, 167, 0.5), 0 0 20px rgba(0, 201, 167, 0.3);
        }
        /* -------------------------------------------------- */


        .card-container {
            width: 100%;
            max-width: 640px;
            /* Height changes based on content (login is shorter, chat is taller) */
            display: flex;
            flex-direction: column;
            /* --- RADIANT TEAL & SHINY TEXTURE STYLES (Outer container) --- */
            background: linear-gradient(145deg, var(--radiant-blue-start) 0%, var(--radiant-blue-end) 100%);
            border: 2px solid rgba(255, 255, 255, 0.5); /* Lighter border for shine */
            border-radius: 1rem;
            box-shadow: 0 0 40px rgba(0, 201, 167, 0.6), inset 0 0 15px rgba(255, 255, 255, 0.3); /* Teal Glow and inner shine */
            overflow: hidden;
            z-index: 1;
        }

        /* Styling for the Welcome Screen (centered within the container) */
        #login-view {
            width: 100%;
            height: 90vh;
            max-height: 800px;
            justify-content: center;
            align-items: center;
            padding: 2rem;
        }

        /* Cool Glassmorphism Welcome Card */
        #login-card {
            background-color: rgba(255, 255, 255, 0.95); /* Near opaque white for contrast */
            backdrop-filter: blur(15px); /* Stronger frosted glass effect */
            -webkit-backdrop-filter: blur(15px); /* For Safari support */
            padding: 2.5rem; /* Increased padding */
            border-radius: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.7); 
            box-shadow: 0 10px 40px 0 rgba(0, 0, 0, 0.35); /* Stronger shadow */
            width: 100%;
            max-width: 450px; /* Wider card */
            text-align: center;
            transition: all 0.3s ease;
            transform: scale(1.05);
        }
        
        /* --- CHAT VIEW STYLES --- */
        #chat-view {
            width: 100%;
            max-width: 640px;
            height: 90vh;
            max-height: 800px;
            display: none; /* Controlled by JS */
            flex-direction: column;
        }
        #chat-container {
            width: 100%;
            height: 100%;
            flex-direction: column; 
        }

        .chat-header {
            padding: 1rem; 
            color: white; 
            display: flex; 
            align-items: center; 
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
            background: linear-gradient(145deg, var(--radiant-blue-start) 0%, var(--radiant-blue-end) 100%);
        }
        
        #chat-history {
            flex-grow: 1;
            overflow-y: auto;
            padding: 1rem;
            background-color: white; 
            scroll-behavior: smooth;
        }
        .dark #chat-history {
            background-color: var(--surface-color);
        }

        /* Input Area update - kept white for contrast */
        #input-area {
            padding: 1rem; 
            border-top: 1px solid #ccc; 
            background-color: white; 
            display: flex; 
            align-items: center;
        }
        .dark #input-area {
            background-color: var(--surface-color);
            border-top-color: #333;
        }

        /* --- NEW SUGGESTION BUTTON STYLES (Restored) --- */
        .suggestion-button {
            padding: 0.5rem 1rem;
            background-color: #f0fdfa; /* Lightest Teal/Mint */
            border: 1px solid #00C9A7;
            color: #006494; /* Deep Blue text for visibility */
            font-size: 0.875rem;
            font-weight: 600;
            border-radius: 9999px; /* Full rounded corners */
            cursor: pointer;
            transition: all 0.2s ease;
            transform: scale(0.95);
        }
        .suggestion-button:hover {
            background-color: #00C9A7;
            color: white;
            transform: scale(1.0);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        .dark .suggestion-button {
            background-color: #2e2e2e;
            border-color: #006494;
            color: #00C9A7;
        }
        .dark .suggestion-button:hover {
            background-color: #00A887;
            color: #1f1f1f;
        }
        /* --- END SUGGESTION STYLES --- */
        
        /* --- INPUT FOCUS GLOW --- */
        #user-input {
            transition: box-shadow 0.3s ease;
        }
        #user-input:focus {
            box-shadow: 0 0 0 4px rgba(0, 201, 167, 0.4); /* Teal glow */
        }
        .dark #user-input {
            background-color: #333;
            color: white;
            border-color: #555;
        }
        /* --- END INPUT FOCUS GLOW --- */


        /* Styling for the messages */
        .message-bubble {
            padding: 0.75rem 1rem;
            border-radius: 1.25rem;
            max-width: 85%;
            margin-bottom: 0.75rem;
            line-height: 1.5;
            word-wrap: break-word;
            /* Added pop-in animation to bot responses */
            animation: pop-in 0.3s ease-out;
        }
        .user-message {
            background-color: var(--user-bubble);
            color: white;
            margin-left: auto;
            border-bottom-right-radius: 0.25rem;
        }
        .bot-message {
            background-color: var(--bot-bubble);
            color: #111827; /* Darker Gray text for high contrast */
            margin-right: auto;
            border-bottom-left-radius: 0.25rem;
            white-space: pre-wrap;
        }
        .dark .bot-message {
            background-color: var(--bot-bubble); /* Darker bot bubble */
            color: var(--text-color); /* Light text in dark mode */
        }

        /* Style for anchor tags in the bot's response to make them stand out */
        .bot-message a {
            color: #006494; /* Deep Blue link color */
            text-decoration: underline;
            font-weight: 700;
        }
        .dark .bot-message a {
            color: var(--link-color);
        }

        /* --- NEW STYLES FOR NEAT RESPONSES --- */
        .info-card {
            background-color: #ffffff;
            border-radius: 0.75rem;
            padding: 1rem;
            border: 1px solid #c9d6e4; 
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
            margin-top: 0.5rem;
            word-break: break-word;
        }
        .dark .info-card {
            background-color: #2e2e2e; /* Slightly lighter surface for nested card */
            border-color: #555;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }

        .info-card ul {
            display: flex;
            flex-wrap: wrap; 
            padding: 0;
            margin: 0;
            list-style: none;
        }
        .info-card li {
            list-style: none;
        }
        .info-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: 0.5rem;
            width: 50%;
            min-width: 150px;
            padding-right: 1rem;
        }
        @media (max-width: 480px) {
            .info-item {
                width: 100%;
            }
        }
        .info-icon {
            font-size: 1.2rem;
            margin-right: 0.5rem;
            color: var(--primary-color); /* Teal icon color */
            line-height: 1.5;
            flex-shrink: 0;
        }
        .link-list {
            list-style: none;
            padding: 0;
            margin-top: 0.5rem;
        }
        .link-list li {
            margin-bottom: 0.3rem;
            padding-left: 1.5rem;
            position: relative;
        }
        .link-list li::before {
            content: "🔗";
            position: absolute;
            left: 0;
            top: 0;
        }
        /* --- NEW GRAPH SUMMARY STYLES --- */
        .graph-summary {
            margin-top: 1rem;
            padding-top: 0.75rem;
            border-top: 1px solid #c9d6e4;
            font-size: 0.95rem;
        }
        .dark .graph-summary {
            border-top-color: #555;
        }
        .graph-summary p {
            margin-bottom: 0.5rem;
        }
        .graph-summary strong {
            color: #006494; /* Deep Blue for highlights */
        }
        .dark .graph-summary strong {
            color: #00D2D3; /* Lighter highlight in dark mode */
        }
        /* ------------------------------------- */

        /* --- NEW LOADING ANIMATION (Thinking Icon) --- */
        #loading-indicator .bot-message {
            font-size: 1.5rem; /* Make the icon size visible */
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .thinking-icon {
            animation: thinking-spin 1.5s infinite linear;
        }
        @keyframes thinking-spin {
            0% { transform: scale(0.9) rotate(0deg); opacity: 0.8; }
            50% { transform: scale(1.1) rotate(180deg); opacity: 1.0; }
            100% { transform: scale(0.9) rotate(360deg); opacity: 0.8; }
        }
        /* --- END NEW LOADING ANIMATION --- */

        /* --- New Pop-In Animation for Bubbles --- */
        @keyframes pop-in {
            0% {
                opacity: 0;
                transform: scale(0.8);
            }
            100% {
                opacity: 1;
                transform: scale(1);
            }
        }
        /* --- END Pop-In Animation --- */
        
        /* --- BUTTON CLICK ANIMATION --- */
        .button-click-animation {
            transition: transform 0.1s;
        }
        .button-click-animation:active {
            transform: scale(0.9);
        }
        /* --- END BUTTON CLICK ANIMATION --- */


        .mic-active {
            animation: pulse-mic 1s infinite alternate;
        }
        @keyframes pulse-mic {
            from {
                box-shadow: 0 0 0 0 rgba(0, 201, 167, 0.7);
                background-color: #ff6347; /* Tomato red when recording */
            }
            to {
                box-shadow: 0 0 0 10px rgba(0, 201, 167, 0);
                background-color: #ff4500;
            }
        }

        /* --- NEW DASHBOARD ANIMATION --- */
        @keyframes scale-up {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        .fade-in-up {
            animation: fadeInUp 0.6s ease-out both;
        }
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translate3d(0, 20px, 0);
            }
            to {
                opacity: 1;
                transform: translate3d(0, 0, 0);
            }
        }
        .feature-item {
            transition: all 0.2s ease;
        }
        .feature-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
    </style>
</head>
<body>

<!-- Welcome View - Visible by default -->
<div id="login-view" class="card-container flex">
    <div id="login-card" class="fade-in-up">
        <!-- Professional Branding and Greeting -->
        <div class="flex flex-col items-center mb-6">
            <div class="p-4 bg-[#00C9A7] rounded-full mb-3 shadow-xl">
                <svg class="w-10 h-10 text-white" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" x2="12" y1="19" y2="22"/></svg>
            </div>
            <h2 class="text-3xl font-extrabold text-gray-900">Welcome to Pragati Insight</h2>
            <p class="text-gray-500 mt-1">Your Official AI-Powered Student Command Center</p>
        </div>

        <!-- Aesthetic Separator -->
        <div class="w-20 h-1 bg-[#00C9A7] mx-auto mb-6 rounded-full"></div>

        <!-- Key Feature Panel -->
        <div class="mb-8 grid grid-cols-2 gap-4 text-left">
            <div class="feature-item p-3 border border-gray-200 rounded-lg bg-white/70">
                <p class="font-bold text-[#006494] flex items-center">
                    <svg class="w-4 h-4 mr-1" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m21 16-4 4-4-4"/><path d="M17 16v5"/><path d="M17 3v5"/><path d="m21 8-4-4-4 4"/><path d="M8 3H4v16a2 2 0 0 0 2 2h10"/></svg>
                    Live Data
                </p>
                <p class="text-xs text-gray-600 mt-1">Real-time answers for packages & faculty status.</p>
            </div>
            <div class="feature-item p-3 border border-gray-200 rounded-lg bg-white/70">
                <p class="font-bold text-[#006494] flex items-center">
                    <svg class="w-4 h-4 mr-1" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="20" height="12" x="2" y="6" rx="2"/><path d="M6 18v-2"/><path d="M10 18v-4"/><path d="M14 18v-6"/><path d="M18 18v-8"/></svg>
                    Data Insights
                </p>
                <p class="text-xs text-gray-600 mt-1">Interactive graphs for placement trends.</p>
            </div>
            <div class="feature-item p-3 border border-gray-200 rounded-lg bg-white/70">
                <p class="font-bold text-[#006494] flex items-center">
                    <svg class="w-4 h-4 mr-1" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 14c.2-.8 1-1.5 2-2 2.3-2.3 6-4-6-4s-8.3 1.7-6 4c1 1 1.7 1.2 2 2"/><path d="M12 18.5a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5z"/></svg>
                    Official Docs
                </p>
                <p class="text-xs text-gray-600 mt-1">Direct links to all Syllabus and Academic Calendars.</p>
            </div>
            <div class="feature-item p-3 border border-gray-200 rounded-lg bg-white/70">
                <p class="font-bold text-[#006494] flex items-center">
                    <svg class="w-4 h-4 mr-1" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>
                    24/7 Access
                </p>
                <p class="text-xs text-gray-600 mt-1">Instant support via text or voice input.</p>
            </div>
        </div>

        <!-- Start Chat Button -->
        <button onclick="startChat()"
                class="w-full p-4 mt-2 bg-[#00C9A7] text-white text-xl font-bold rounded-lg hover:bg-[#00A887] transition duration-150 shadow-lg transform hover:scale-[1.02] active:scale-[0.98] focus:outline-none focus:ring-4 focus:ring-[#00C9A7]/50">
            Start Chatting Now
        </button>
    </div>
</div>

<!-- Chat View - Hidden by default -->
<div id="chat-view" class="card-container hidden">
    <div id="chat-container" class="w-full h-full flex flex-col">
        <!-- Header (Updated with Dark Mode Toggle) -->
        <header class="chat-header">
            <div class="p-2 bg-white/20 rounded-full mr-3">
                <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: white;"><path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" x2="12" y1="19" y2="22"/></svg>
            </div>
            <div>
                <h1 class="text-lg font-semibold">Pragati Engineering College Bot</h1>
                <p class="text-xs opacity-80">24/7 Student Support Assistant</p>
            </div>
            <!-- NEW DARK MODE TOGGLE BUTTON -->
            <button id="mode-toggle" 
                    onclick="toggleDarkMode()"
                    class="ml-auto p-2 rounded-full hover:bg-white/30 transition duration-150 button-click-animation"
                    title="Toggle Dark Mode">
                <svg id="moon-icon" class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: white;"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/></svg>
                <svg id="sun-icon" class="w-6 h-6 hidden" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: white;"><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></svg>
            </button>
        </header>

        <!-- Chat History --><div id="chat-history">
            <!-- Initial welcome message added via JS after starting chat -->
        </div>

        <!-- Suggestion Area (Restored for UX) -->
        <div id="suggestion-area" class="p-3 bg-white border-t border-gray-100 flex flex-wrap gap-2 transition-all duration-300">
            <!-- Suggestions will be rendered here -->
        </div>
        <script>
            document.getElementById('suggestion-area').classList.remove('p-3');
            document.getElementById('suggestion-area').style.height = '0';
        </script>


        <!-- Input Area --><div id="input-area">
            <input type="text" id="user-input" placeholder="Ask a question..."
                   class="flex-grow p-3 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-[#00C9A7] transition duration-150"
                   autofocus>

            <!-- New Voice Input Button --><button id="voice-button"
                    class="ml-3 p-3 bg-[#00C9A7] text-white rounded-full hover:bg-[#00A887] transition duration-150 shadow-md disabled:bg-[#00C9A7]/50 button-click-animation"
                    onclick="startVoiceInput()">
                <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" x2="12" y1="19" y2="22"/></svg>
            </button>

            <!-- Send Button --><button id="send-button"
                    class="ml-3 p-3 bg-[#00C9A7] text-white rounded-full hover:bg-[#00A887] transition duration-150 shadow-md disabled:bg-[#00C9A7]/50 button-click-animation"
                    onclick="sendMessage()">
                <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m22 2-7 20-4-9-9-4Z"/><path d="M22 2 11 13"/></svg>
            </button>
        </div>
    </div>
</div>

<script>
    // --- PLACEMENT DATA (Hardcoded Sample Data for Chart) ---
    const PLACEMENT_DATA = {
        years: ['2022', '2023', '2024', '2025 (Ongoing)'],
        highest: [31.31, 29.26, 35.0, 40.0], // Sample data, 40 LPA is from KB
        average: [3.0, 4.0, 4.5, 5.5], // Sample data
    };
    
    // --- STAFF CONTACTS (CONSOLIDATED DATABASE) ---
    // This array is the single source of truth for all staff data provided across all 16 CSV sheets.
    const STAFF_CONTACTS = [
        // --- KEY PERSONNEL / MAIN LINES (from dept HoDs phone .csv) ---
        { name: "Principal Sir", number: "9618787861", designation: "Principal" },
        { name: "Hostel (Reception)", number: "9618787862", designation: "Reception" },
        { name: "Discipline Officer", number: "9618787863", designation: "Discipline Officer" },
        { name: "Adi Narayana (Discipline)", number: "9618787863", designation: "Discipline Officer" },
        { name: "Sunil Raj (Transport)", number: "9618701133", designation: "Transport Coordinator" },
        { name: "Xerox", number: "9848183369", designation: "Xerox Section" },
        { name: "Civil Department", number: "9618757861", designation: "Civil HOD/Main Dept Line" },
        { name: "EEE Department", number: "9618757862", designation: "EEE HOD/Main Dept Line" },
        { name: "MECH Department", number: "9618757863", designation: "MECH HOD/Main Dept Line" },
        { name: "ECE Department", number: "9618757864", designation: "ECE HOD/Main Dept Line" },
        { name: "CSE Department", number: "9618757865", designation: "CSE HOD/Main Dept Line" },
        { name: "IT Department", number: "9618757860", designation: "IT HOD/Main Dept Line" },
        { name: "CSE (CS) Department", number: "7995313377", designation: "CSE (CS) Dept Line" },
        { name: "CSE (DS) Department", number: "7995785588", designation: "CSE (DS) Dept Line" },
        { name: "CSE (AI) Department", number: "7702842266", designation: "CSE (AI) Dept Line" },
        { name: "CSE (AI&ML) Department", number: "9000195104", designation: "CSE (AI&ML) Dept Line" },
        { name: "BS&H Department", number: "9618787860", designation: "BS&H HOD/Main Dept Line" },
        
        // --- CIVIL DEPARTMENT STAFF ---
        { name: "Dr. K.Saroja Rani", number: "9502255765", designation: "Associate Professor, CIVIL" },
        { name: "Mrs. V.Tanuja", number: "9703065276", designation: "Assistant Professor, CIVIL" },
        { name: "Mr. B.Sri Kalyan", number: "7382781194", designation: "Assistant Professor, CIVIL" },
        { name: "Mr. D.V.D.Prasad", number: "8008300313", designation: "Assistant Professor, CIVIL" },
        { name: "Mr. V.Sai Kiran", number: "8008941069", designation: "Assistant Professor, CIVIL" },
        { name: "Mr. B.Sri Datta Subramanyam", number: "9989803199", designation: "Assistant Professor, CIVIL" },
        { name: "Mr. L.Praveen Kumar", number: "9573093908", designation: "Assistant Professor, CIVIL" },
        { name: "Ms. V.Chandu", number: "8074782745", designation: "Lab Technician, CIVIL" },
        { name: "Mrs. B. Kanaka Durga", number: "6281245488", designation: "DTP Operator, CIVIL" },
        
        // --- EEE DEPARTMENT STAFF ---
        { name: "K.V. DURGA PRASAD", number: "7396066636", designation: "ASST. PROFESSOR, EEE" },
        { name: "K. SIVA SANKAR", number: "9848555577", designation: "ASST. PROFESSOR, EEE" },
        { name: "M. MANISANKAR", number: "9000681167", designation: "ASST. PROFESSOR, EEE" },
        { name: "V.R.V.S. SAI VALLI", number: "9491222728", designation: "ASST. PROFESSOR, EEE" }, 
        { name: "P. SANDHYA", number: "9603043462", designation: "ASST. PROFESSOR, EEE" },
        { name: "D. PRAKASA RAO", number: "9866201153", designation: "ASST. PROFESSOR, EEE" },
        { name: "P. VARALAKSHMI", number: "6305546589", designation: "ASST. PROFESSOR, EEE" },
        { name: "S. NANI BABU", number: "9121607380", designation: "ASST. PROFESSOR, EEE" },
        { name: "P. PUSHPA LATHA", number: "9553623123", designation: "ASST. PROFESSOR, EEE" },
        { name: "P.V.V. RAMANA", number: "9989527134", designation: "ASST. PROFESSOR, EEE" },
        { name: "K. TATABBAI", number: "8106288977", designation: "LAB TECHNICIAN, EEE" },
        { name: "K. SRIRAM", number: "9393752388", designation: "LAB TECHNICIAN, EEE" },
        { name: "Y.H.S.S. PHANEENDRA", number: "9030498804", designation: "LAB TECHNICIAN, EEE" },
        { name: "Y. MANIKANTA", number: "9133609164", designation: "LAB TECHNICIAN, EEE" },
        { name: "B. ARUNA KUMAR", number: "9182541906", designation: "JUNIOR ASSISTANT, EEE" },

        // --- MECH DEPARTMENT STAFF ---
        { name: "Dr Avinash G", number: "9866443604", designation: "HoD-ME, MECH" },
        { name: "Mr. D.J. Johnson", number: "6305858826", designation: "Assoc. Prof, MECH" },
        { name: "Mr. M. Sunil Raj", number: "9989798969", designation: "Assoc. Prof, MECH" },
        { name: "Mrs. K. Aravinda", number: "9949183736", designation: "Asst. Prof, MECH" },
        { name: "Mr. N. Raghuveer", number: "9177709223", designation: "Asst. Prof, MECH" },
        { name: "Mr. V.V.N. Sarath", number: "9652299245", designation: "Asst. Prof, MECH" },
        { name: "Mr. P. Ram Prasad", number: "9550731375", designation: "Asst. Prof, MECH" },
        { name: "Mr. A. Phani Bhaskar", number: "8121412442", designation: "Asst. Prof, MECH" },
        { name: "Mrs. P. Gayathri", number: "7702636534", designation: "Asst. Prof, MECH" },
        { name: "Mr.A. Yeswanth", number: "9492511943", designation: "Asst. Prof, MECH" },
        { name: "Mrs. K. Tulasi", number: "9959833497", designation: "Asst. Prof, MECH" },
        { name: "Mr. K. Sree Ramachandra Murthy", number: "7799838226", designation: "Asst. Prof, MECH" },
        { name: "Mr. B. Hari Krishna", number: "6281813597", designation: "Asst. Prof, MECH" },
        { name: "Mr. B. Bharath Kumar", number: "9505550090", designation: "Asst. Prof, MECH" },
        { name: "Mr. V. Murali Krishna", number: "9573062377", designation: "Lab Technician, MECH" },
        { name: "Mr. G. Soma Raju", number: "9618971864", designation: "Lab Technician, MECH" },
        { name: "Mr. Ch. Syam Pradeep Kumar", number: "7032089099", designation: "Lab Technician, MECH" },
        { name: "Mr. A. Satyanarayana Murthy", number: "9676286042", designation: "Lab Technician, MECH" },
        { name: "Mr. Ch. S S Bhaskara Rao", number: "7675915844", designation: "Lab Technician, MECH" },
        { name: "Mrs. R.Vasundhara", number: "9542271769", designation: "Computer Operator, MECH" },

        // --- ECE DEPARTMENT STAFF ---
        { name: "Dr V Sailaja", number: "9491444434", designation: "Professor, ECE" },
        { name: "Dr. Subodh Panda", number: "9337994245", designation: "Professor, ECE" },
        { name: "Dr. V. Radhika", number: "9849755182", designation: "Professor, ECE" },
        { name: "Dr. Sharon Rose Victor. J.", number: "7981230819", designation: "Associate Professor, ECE" },
        { name: "Dr B N Srinivasarao", number: "8328181276", designation: "Associate Professor, ECE" },
        { name: "Dr. Ch. Venkateswarlu", number: "8919359853", designation: "Associate Professor, ECE" },
        { name: "Mr. V. Prasanth", number: "7660941116", designation: "Associate Professor, ECE" },
        { name: "Mr. G.S. Sivakumar", number: "9949811979", designation: "Associate Professor, ECE" },
        { name: "Mrs. B. Vasantha Lakshmi", number: "9912717447", designation: "Associate Professor, ECE" },
        { name: "Mr. Ch. Satish", number: "9154889353", designation: "Assistant Professor, ECE" },
        { name: "Mrs. L. Gaviramma", number: "9440427485", designation: "Assistant Professor, ECE" },
        { name: "Ms. Rubia Tasneem", number: "9182874366", designation: "Assistant Professor, ECE" },
        { name: "Mr. P. Krishna Chaitanya", number: "8309247775", designation: "Assistant Professor, ECE" },
        { name: "Mrs. D.V.V. Lakshmi", number: "7729806111", designation: "Assistant Professor, ECE" },
        { name: "Mrs. P. Ramya Krishna", number: "9533333596", designation: "Assistant Professor, ECE" },
        { name: "Mr. T. Sekhar", number: "9542372399", designation: "Assistant Professor, ECE" },
        { name: "Mr. M. Brahma Raju", number: "8639777764", designation: "Assistant Professor, ECE" },
        { name: "Mrs. G Viranya", number: "8125922090", designation: "Assistant Professor, ECE" },
        { name: "Mr. K. Akhil", number: "7382646821", designation: "Assistant Professor, ECE" },
        { name: "Mr. B. Kalyan Charavarthy", number: "9703852614", designation: "Assistant Professor, ECE" },
        { name: "Mr. G. Raju", number: "9000566313", designation: "Assistant Professor, ECE" },
        { name: "Mr. Y. Vijay Kumar", number: "9480398751", designation: "Assistant Professor, ECE" },
        { name: "Mrs. M. Geetha", number: "7287847289", designation: "Assistant Professor, ECE" },
        { name: "Mrs. T. Subhasri", number: "9491447916", designation: "Assistant Professor, ECE" },
        { name: "Mr. B T S S Srihari", number: "9182314528", designation: "Assistant Professor, ECE" },
        { name: "Mr N.Swami Dattatreyachari", number: "8790611888", designation: "Assistant Professor, ECE" },
        { name: "Mr.P.Ravi Sankar", number: "8125578099", designation: "Assistant Professor, ECE" },
        { name: "Mrs.Jyothi", number: "9000088467", designation: "Assistant Professor, ECE" },
        { name: "Ms K Prasanthi", number: "6281829439", designation: "Assistant Professor, ECE" },
        { name: "Mrs K Dharma Ratnam", number: "9491104247", designation: "Assistant Professor, ECE" },
        { name: "Ch Maheswara Rao", number: "9296050405", designation: "Lab Technician, ECE" },
        { name: "V V S Vanisree", number: "9063381990", designation: "Lab Technician, ECE" },
        { name: "G Rama Krishna", number: "9581382444", designation: "Lab Technician, ECE" },
        { name: "N Ch Raghu Kishore", number: "8179517343", designation: "Lab Technician, ECE" },
        { name: "P Sravanthi", number: "9912753555", designation: "Lab Technician, ECE" },
        { name: "Lokesh", number: "9491353427", designation: "Lab Technician, ECE" },
        { name: "B Deepthi", number: "8125715202", designation: "Lab Technician, ECE" },
        { name: "M Lakshmi Durga", number: "7842807114", designation: "Operator, ECE" },
        { name: "D Anand", number: "9381664179", designation: "Attender, ECE" },


        // --- CSE DEPARTMENT STAFF (COMPLETELY UPDATED) ---
        { name: "Dr. Y. Jayababu", number: "9948612244", designation: "Professor, CSE" },
        { name: "Dr.M.Radhika Mani", number: "", designation: "Professor, CSE" },
        { name: "Dr.D. V Manjula", number: "9492247662", designation: "HOD - CSE" },
        { name: "Dr.M.Uma Devi", number: "9440896317", designation: "Associate Professor, CSE" },
        { name: "Mr.K.Chandra Sekhar", number: "8008882777", designation: "Assistant Professor, CSE" },
        { name: "Mr.G.Vijay Kumar", number: "8074454807", designation: "Assistant Professor, CSE" },
        { name: "A.Avinash", number: "7780135919", designation: "Assistant Professor, CSE" },
        { name: "Ms.A.Harini", number: "9705300711", designation: "Assistant Professor, CSE" },
        { name: "Mr.KVV Subba Rao", number: "9550014927", designation: "Assistant Professor, CSE" },
        { name: "Mrs.P.Lakshmi Satya", number: "9949612205", designation: "Assistant Professor, CSE" },
        { name: "Mr.Ch.Manikanta Kalyan", number: "9849151430", designation: "Assistant Professor, CSE" },
        { name: "Mr.S K Sankar", number: "9063270672", designation: "Assistant Professor, CSE" },
        { name: "Mrs.T.N.V Durga", number: "9866439710", designation: "Assistant Professor, CSE" },
        { name: "Mrs.Kanaka Tulasi", number: "7731086699", designation: "Assistant Professor, CSE" },
        { name: "Mrs.Sowjanya", number: "7382400024", designation: "Assistant Professor, CSE" },
        { name: "Mrs.K.Sham Sri", number: "8897058321", designation: "Assistant Professor, CSE" },
        { name: "Sayantan Kar", number: "9877439792", designation: "Assistant Professor, CSE" },
        { name: "I.Subbalakshmi", number: "7330720646", designation: "Computer Operator, CSE" },
        { name: "Ch. Rajesh", number: "7801089037", designation: "System Administrator, CSE" },
        { name: "Y.Veerababu", number: "7032428121", designation: "Lab Technician, CSE" },
        { name: "M. Praveen Kumar", number: "8897191045", designation: "Lab Technician, CSE" },
        { name: "V. Gangeswararao", number: "9951132122", designation: "Lab Technician, CSE" },
        { name: "D. Gayatri", number: "7842875006", designation: "Programmer, CSE" },
        { name: "Y. Gayatri", number: "8332904020", designation: "Programmer, CSE" },
        { name: "R. Supriya", number: "8106453755", designation: "Programmer, CSE" },
        { name: "U. Shankar Babu", number: "7013979715", designation: "System Admin, CSE" },
        { name: "D. Kanaka Mahalakshmi Devi", number: "8331883748", designation: "Assistant Professor, CSE" },
        { name: "Manas Kumar Yogi", number: "9966979279", designation: "Assistant Professor, CSE" },

        // --- IT & CS DEPARTMENT STAFF ---
        { name: "Mrs. T Ganga Bhavani", number: "8639777155", designation: "Assistant Professor, IT" },
        { name: "Mr. G Satya Mohna Chowdary", number: "9959088282", designation: "Assistant Professor, IT" },
        { name: "Mr. D Konda Babu", number: "9440410443", designation: "Assistant Professor, IT" },
        { name: "Mrs. A Manga Devi", number: "9247191210", designation: "Assistant Professor, IT" },
        { name: "Ms. J N S Kalyani", number: "7729084751", designation: "Assistant Professor, IT" },
        { name: "Mrs. K Sreesha", number: "9052882133", designation: "Programmer, IT" },
        { name: "Mr. V Kamesh", number: "7801009585", designation: "Lab Technician, IT" },
        { name: "Mr. O yesoda Krishna ", number: "8886374613", designation: "Lab Technician, IT" },
        { name: "Ms. Y Lakshmi Prasanna", number: "8341161550", designation: "Programmer, IT" },
        { name: "Ms. P Gowthami", number: "9392745762", designation: "Computer Operator, IT" },
        
        // --- CSE (AI) DEPARTMENT STAFF ---
        { name: "Mrs. K Lakshmi Viveka", number: "9642788777", designation: "Associate Prof & HoD, CSE (AI)" },
        { name: "Mrs. T Tejasvi", number: "9505150735", designation: "Assistant Professor, CSE (AI)" },
        { name: "Mr. M S V V Ramesh", number: "8639797917", designation: "Assistant Professor, CSE (AI)" },
        { name: "Mr. M Veerababu", number: "9491629344", designation: "Assistant Professor, CSE (AI)" },
        { name: "Mrs. Ch Sri Divya", number: "9492113320", designation: "Assistant Professor, CSE (AI)" },
        { name: "Mr. S S V S Santosh Kumar", number: "9550742920", designation: "Assistant Professor, CSE (AI)" },
        { name: "Mr. K Sri Hari", number: "9014032554", designation: "Programmer, CSE (AI)" },
        { name: "Mr. G Raja Babu", number: "7396544538", designation: "Computer Operator, CSE (AI)" },
        { name: "Mrs. P Vara Lakshmi", number: "8498921663", designation: "Attender, CSE (AI)" },

        // --- CSE (DS) DEPARTMENT STAFF ---
        { name: "Mr. M. V. Rajesh", number: "7702482324", designation: "Assoc Prof, CSE (DS)" },
        { name: "Mrs. N.V.S. Sowjanya", number: "9705766038", designation: "Asst Prof, CSE (DS)" },
        { name: "Mr. K. Srikanth", number: "9154020707", designation: "Asst Prof, CSE (DS)" },
        { name: "Mrs. CH. Veera Gayathri", number: "9347397805", designation: "Asst Prof, CSE (DS)" },
        { name: "Ms. Y Suma Chamundeswari", number: "8790429794", designation: "Asst Prof, CSE (DS)" },
        { name: "Mrs. Lakshmi Sai Prasuna", number: "9014930523", designation: "Progarmmer, CSE (DS)" },
        { name: "Mr. N. Sriram", number: "8985881277", designation: "Progarmmer, CSE (DS)" },
        { name: "Mr. S. Bharadwaj", number: "9640892552", designation: "Technician, CSE (DS)" },
        { name: "K. Vasantha", number: "9059779323", designation: "Computer Operator, CSE (DS)" },
        { name: "K. Vara Lakshmi", number: "8498921663", designation: "Attender, CSE (DS)" },

        // --- CSE (AI&ML) DEPARTMENT STAFF ---
        { name: "Dr. A. Radha Krishna", number: "9440614466", designation: "Professor, CSE (AI&ML)" },
        { name: "Mrs. V. Anantha Lakshmi", number: "9493568179", designation: "Asst. Prof, CSE (AI&ML)" },
        { name: "Mr. A. Janardhana Rao", number: "6281866876", designation: "Asst. Prof, CSE (AI&ML)" },
        { name: "Mrs. L. Yamuna", number: "8519997240", designation: "Asst. Prof, CSE (AI&ML)" },
        { name: "Mrs. G. V .Rajeswari", number: "8142767655", designation: "Asst. Prof, CSE (AI&ML)" },
        { name: "Mrs. G. Tejasri Devi", number: "7382407013", designation: "Asst. Prof, CSE (AI&ML)" },
        { name: "Mrs. P. Satyavathi", number: "8179667416", designation: "Asst. Prof, CSE (AI&ML)" },
        { name: "Mrs. M. Mani Deepika", number: "9550374458", designation: "Asst. Prof, CSE (AI&ML)" },
        { name: "Mrs. A .Srujana Jyothi", number: "9347277603", designation: "Asst. Prof, CSE (AI&ML)" },
        { name: "Mrs. K.S.R. Manjusha", number: "8074484878", designation: "Asst. Prof, CSE (AI&ML)" },
        { name: "Ms. P. Pravallika", number: "7661996684", designation: "Computer Operator, CSE (AI&ML)" },
        { name: "Ms. M. Nagalakshmi", number: "7386461221", designation: "Programmer, CSE (AI&ML)" },
        { name: "Mr. K Chakra Rao", number: "7995161688", designation: "Attender, CSE (AI&ML)" },
        
        // --- BS&H DEPARTMENT STAFF ---
        { name: "Dr. T. Satyanarayana", number: "9490480223", designation: "Assoc.Prof, BS&H" },
        { name: "Mr. P. Madhu Babu", number: "9701756233", designation: "Asst.Prof, BS&H" },
        { name: "Mr. A. Nagendra", number: "9666100897", designation: "Assoc.Prof, BS&H" },
        { name: "Mrs. V. Indira Priyadarsini", number: "8919761836", designation: "Assoc.Prof, BS&H" },
        { name: "Mrs. V. Durga Bhavani", number: "6302742858", designation: "Assoc.Prof, BS&H" },
        { name: "Ms. V. Bhavani", number: "9705956576", designation: "Asst.Prof, BS&H" },
        { name: "Mr. B. Akashay Deep", number: "8885902298", designation: "Asst.Prof, BS&H" },
        { name: "Mrs. M. Iswarya", number: "9740544466", designation: "Asst.Prof, BS&H" },
        { name: "Mr. K. V. Narayana", number: "8096156000", designation: "Assoc.Prof, BS&H" },
        { name: "Mrs. M. Chandralekha", number: "", designation: "Assoc.Prof, BS&H" }, // Number Missing
        { name: "Dr. J. D. Naidu", number: "9959375696", designation: "Assoc.Prof, BS&H" },
        { name: "Dr. K. Chakrapani", number: "9392003335", designation: "Assoc.Prof, BS&H" },
        { name: "Dr. S. Prasad", number: "9494437872", designation: "Assoc.Prof, BS&H" },

        // --- CDC DEPARTMENT STAFF ---
        { name: "Dr. M. Radhika Mani", number: "7702666337", designation: "Dean - CDC" },
        { name: "Mr. Ch. Satish (Aptitude)", number: "9959679067", designation: "Aptitude Assistant Professor, CDC" },
        { name: "Mr. P. Prasad Babu (Aptitude)", number: "9394521108", designation: "Aptitude Assistant Professor, CDC" },
        { name: "Mr. D. Hanumantha Rao (Aptitude)", number: "6301994493", designation: "Aptitude Assistant Professor, CDC" },
        { name: "Mr. K.T.K. Mohan (Technical)", number: "7995161698", designation: "Technical Assistant Professor, CDC" },
        { name: "Mrs. M. Madhavi (Verbal Ability)", number: "8886584852", designation: "Verbal Ability Assistant Professor, CDC" },
        { name: "Mr. G. Venkata Ratnam (Verbal)", number: "9177551009", designation: "Verbal Ability Assistant Professor, CDC" },
        { name: "Dr. P. C. Viswanth (Verbal)", number: "9705932211", designation: "Verbal Ability Assistant Professor, CDC" },
        { name: "Mrs. K.V. Sirisha Devi", number: "9704017194", designation: "Computer Operator, CDC" },
        { name: "Mrs. N. Naga Swathi", number: "9703775871", designation: "Computer Operator, CDC" },
        
        // --- MEFA (MANAGEMENT) DEPARTMENT STAFF ---
        { name: "Mr. KSVGK Murthy", number: "9618888058", designation: "Associate Professor, MEFA" },
        { name: "Mr. K. Anand", number: "9133621114", designation: "Assistant Professor, MEFA" },
        { name: "Mr. G. Prasanna Kumar", number: "8500812541", designation: "Assistant Professor, MEFA" },
        { name: "Mr. PVS Swamy", number: "9704305964", designation: "Assistant Professor, MEFA" },
        { name: "Mrs. G. Pavani", number: "9010319877", designation: "Assistant Professor, MEFA" },
        { name: "Mrs. B. Lova Kumari", number: "9908846657", designation: "Assistant Professor, MEFA" },

        // --- EXAM SECTION STAFF ---
        { name: "Mr. P. Raja Kumar", number: "9502655666", designation: "Exam Section Staff" },
        { name: "Mr. N.V. Satyanarayana", number: "9666704259", designation: "Computer Operator, Exam Section" },
        { name: "Mr. M. Sateesh", number: "9640036111", designation: "Jr. Assistant, Exam Section" },
        { name: "Mr. Ch.V.S.N. Vamsi", number: "7995183975", designation: "Jr. Assistant, Exam Section" },
        { name: "Mr. B. Sandeep", number: "9133825167", designation: "Attender, Exam Section" },
        
        // --- ADMIN & NON-TEACHING STAFF ---
        { name: "Mr. P Ram Mohan Rao", number: "9515831098", designation: "Office Supdt, Administrative Office" },
        { name: "Mr. B Papa Rao", number: "9866172537", designation: "Sr. Asst., Administrative Office" },
        { name: "Mr. K Hari Kumar", number: "9705177399", designation: "Sr. Asst., Administrative Office" },
        { name: "Mr. K V Govind Babu", number: "9701201868", designation: "Sr. Asst., Administrative Office" },
        { name: "Mr. Y Chandra Kumar", number: "9676913112", designation: "Sr. Asst., Administrative Office" },
        { name: "Mrs. B Perim Devi", number: "9652067735", designation: "Sr. Asst., Administrative Office" },
        { name: "Mr. K V Rama Krishna", number: "8125398706", designation: "Administrative Staff" },
        { name: "Mr. K Ram Mohan Rao", number: "9550727417", designation: "Sr. Asst., Administrative Office" },
        { name: "Mr. B Aruna Kumar", number: "9182541906", designation: "Jr. Asst., Administrative Office" },
        { name: "Mr. K Suresh (Receptionist)", number: "9849664907", designation: "Jr. Asst. & Receptionist" },
        { name: "Mr. S Baby", number: "9491540350", designation: "Staff Nurse" },
        { name: "Mr. G Durga Prasad", number: "9391229061", designation: "Warden" },
        { name: "Mr. P Atchyutha Kumar", number: "6300975587", designation: "Warden" },
        { name: "Mr. Y Satyanarayana", number: "9989798969", designation: "Administrative Staff" }, // Note: This number overlaps with M. Sunil Raj Transport. Kept for completeness.
        { name: "Mrs. S Anantha Lakshmi", number: "9701195749", designation: "Aaya" },
        { name: "Mrs. I Satyaveni", number: "9100085853", designation: "Aaya" },
        { name: "Mr. R Vinod", number: "8185816294", designation: "Attender" },
        { name: "Mr. M Raviteja", number: "9177658648", designation: "Attender" },
        { name: "Mr. P Seshu Kumar", number: "6301333147", designation: "Attender" },
        { name: "Mr. V Nookaraju", number: "8008609308", designation: "Attender" },
        { name: "Mr. Bolisetty Venkateswara Rao", number: "9494273448", designation: "Attender" },
        { name: "Mr. D Anand", number: "9381664179", designation: "Attender" },
        { name: "Mr. K Vishnu", number: "9490360273", designation: "Attender" },
        { name: "Mrs. K Vara Lakshmi", number: "8498921663", designation: "Attender" },
        { name: "Mr. B. Sandeep Kumar", number: "9133825167", designation: "Attender" },
        { name: "Mr. P Surya Prakash", number: "7995042733", designation: "Attender" },
        { name: "Mr. N V Bhadra Rao", number: "8897956282", designation: "Gardener" },
        { name: "Mr. V Srinivas (Raghava)", number: "9666752807", designation: "Gardener" },
        { name: "Mr. P. Dorababu", number: "9618908643", designation: "Gardener" },
        
        // --- SECURITY & MAINTENANCE STAFF ---
        { name: "Mr. N Nageswara Rao", number: "8106879706", designation: "Security Staff, Maintenance Dept" },
        { name: "Mr. S Sai Kumar", number: "9848304038", designation: "Security Staff, Maintenance Dept" },
        { name: "Mr. M. Suresh", number: "9948098901", designation: "Security Staff, Maintenance Dept" },
        { name: "Mr. Srinuvasu", number: "7842485141", designation: "Security Staff, Maintenance Dept" },
        { name: "Mr. P V Prasad", number: "9640510888", designation: "Security Staff, Maintenance Dept" },
        { name: "Mr. M Chinthamani", number: "8309200144", designation: "Security Staff, Maintenance Dept" },
        { name: "Mr. S Uma Mahesh", number: "8179402772", designation: "Security Staff, Maintenance Dept" },
        { name: "Mr. N Raju", number: "9652125719", designation: "Security Staff, Maintenance Dept" },
        { name: "Mr. Y Murali Krishna", number: "9666775727", designation: "Security Staff, Maintenance Dept" },
        { name: "Mr. S Laacha Babu", number: "8106945015", designation: "Security Staff, Maintenance Dept" },
        { name: "Mr. D V V Sathyanarayana", number: "8985881480", designation: "Security Staff, Maintenance Dept" },
        { name: "Mr. G Pentayya", number: "9951859174", designation: "Security Staff, Maintenance Dept" },
        { name: "Mr. K Veeraju", number: "9652709034", designation: "Security Staff, Maintenance Dept" },
        { name: "Mr. M Srinuvasu", number: "9014227041", designation: "Security Staff, Maintenance Dept" },
        { name: "Mr. R Veera babu", number: "9550577741", designation: "Security Staff, Maintenance Dept" },
    ];
    // --- END STAFF CONTACTS ---

    // --- DEPT SYNONYM MAPPER ---
    const DEPT_MAP = {
        'cse': 'CSE', 'comp': 'CSE', 'cs': 'CSE', 'computer science': 'CSE', 'computer': 'CSE',
        'ece': 'ECE', 'e&c': 'ECE', 'electronics': 'ECE',
        'eee': 'EEE', 'electrical': 'EEE',
        'mech': 'MECH', 'mechanical': 'MECH',
        'it': 'IT', 'information technology': 'IT',
        'civil': 'CIVIL',
        'bs&h': 'BS&H',
        'cdc': 'CDC',
        'mefa': 'MEFA', 'management studies': 'MEFA',
        'exam': 'EXAM', 'exam section': 'EXAM',
        'admin': 'Admin', 'administrator': 'Admin', 'system admin': 'Admin', 'system administrator': 'Admin', 'sysadmin': 'Admin',
        'lab': 'Labs', 'lab technician': 'Labs', 'technician': 'Labs',
        'security': 'Security', 'maint': 'Security', 'maintenance': 'Security',
        'hostel': 'Hostel', 'warden': 'Hostel',
        'transport': 'Transport',
    };

    // --- UTILITY FUNCTIONS ---
    // Cleans name by removing punctuation, spaces, and converting to lowercase for comparison
    const cleanString = (str) => {
        return str.toLowerCase().replace(/[^\w\s]/g, '').replace(/\s+/g, '').trim();
    };
    
    // Strips honorifics and converts to lowercase for primary name comparison
    const normalizeName = (name) => {
        return name.toLowerCase().replace(/^(dr|mr|mrs|ms)\.\s*/, '').replace(/[^a-z0-9\s]/g, ' ').replace(/\s+/g, ' ').trim();
    };

    // --- DEDUPLICATION PASS (Runs once on initialization) ---
    // Note: The raw STAFF_CONTACTS is already defined above and includes all provided data.
    const deduplicateStaff = (staffList) => {
        const uniqueNames = new Map();
        
        staffList.forEach(staff => {
            // Use the cleaned name as the unique key
            const cleanedKey = cleanString(staff.name);
            
            if (!uniqueNames.has(cleanedKey)) {
                // If a name is unique, add the entire staff object
                uniqueNames.set(cleanedKey, staff);
            }
        });
        return Array.from(uniqueNames.values());
    };

    // Replace the raw STAFF_CONTACTS array with the deduplicated list
    const DEDUPLICATED_STAFF_CONTACTS = deduplicateStaff(STAFF_CONTACTS);


    // --- FUNCTION TO SEARCH LOCAL STAFF CONTACTS (FOLLOWS ALL 6 USER RULES) ---
    const findStaffContact = (query) => {
        const queryNormalized = query.toLowerCase().replace(/[^a-z0-9\s]/g, ' ').replace(/\s+/g, ' ').trim();
        const queryParts = queryNormalized.split(' ').filter(p => p.length > 2);
        
        // 0. Akka/Special Case Check
        if (queryNormalized.includes('akka')) {
            return `📇 **Staff Contact Information:**\n\n**Name:** Akka\n**Designation:** Special Contact\n**Department:** N/A\n**Contact Number:** 79899 3489\n\n_For further assistance, please feel free to ask about any other staff member._`;
        }

        // 1. Identify Target Department (Canonical Name)
        let targetDept = null;
        for (const [key, value] of Object.entries(DEPT_MAP)) {
            if (queryNormalized.includes(key)) {
                targetDept = value;
                break;
            }
        }
        
        let preliminaryMatches = [];

        // --- TIER 1 & 2: NAME MATCHING (Exact, Partial) ---
        for (const staff of DEDUPLICATED_STAFF_CONTACTS) {
            const staffNameNormalized = normalizeName(staff.name);
            
            // A. Exact Full Name Match (Case and honorific insensitive)
            if (staffNameNormalized === queryNormalized) {
                preliminaryMatches = [staff];
                break; // Found exact match, terminate name searching
            }
            
            // B. Partial Name Match (Fuzzy match for names)
            const isNamePartialMatch = queryParts.some(part => staffNameNormalized.includes(part));
            
            if (isNamePartialMatch) {
                preliminaryMatches.push(staff);
            }
        }
        
        let finalMatches = [];

        // --- TIER 3: FILTERING BY DEPARTMENT (STRICTLY) ---
        if (preliminaryMatches.length > 0) {
            
            if (targetDept) {
                // Filter the preliminary name matches down to the target department
                finalMatches = preliminaryMatches.filter(staff => {
                    const staffDesignationNormalized = normalizeName(staff.designation);
                    // Check if department shortcut/name exists in the designation string
                    return staffDesignationNormalized.includes(targetDept.toLowerCase());
                });
                
                // If department filtering results in zero matches, revert to original name matches
                if (finalMatches.length === 0) {
                    finalMatches = preliminaryMatches;
                }
                
            } else {
                // No department was specified, keep all name matches
                finalMatches = preliminaryMatches;
            }
        }
        
        // --- TIER 4: DESIGNATION ONLY MATCHES (If Tiers 1-3 yielded nothing or if only designation was searched) ---
        if (finalMatches.length === 0) {
             const titleKeywords = ['hod', 'dean', 'officer', 'administrator', 'technician', 'professor', 'admin', 'system admin', 'programmer'];
             const isTitleQuery = titleKeywords.some(t => queryNormalized.includes(t));

             if (isTitleQuery || !queryNormalized.split(' ').some(p => p.length > 3)) { // Check if it's primarily a title/role search
                 finalMatches = DEDUPLICATED_STAFF_CONTACTS.filter(staff => 
                     normalizeName(staff.designation).includes(queryNormalized) && 
                     (!targetDept || normalizeName(staff.designation).includes(targetDept.toLowerCase()))
                 );
             }
        }
        
        // --- TIER 5: FINAL RESULT PROCESSING (Using Strict Professional Formatting) ---

        // Apply final unique filter (based on cleaned name)
        const uniqueNames = new Map();
        finalMatches.forEach(staff => {
            const cleanedKey = cleanString(staff.name);
            if (!uniqueNames.has(cleanedKey)) {
                // Only map one instance of the person's name
                uniqueNames.set(cleanedKey, staff);
            }
        });
        const uniqueFinalMatches = Array.from(uniqueNames.values());
            
        // Helper function to format a single contact entry block
        const formatContactBlock = (staff) => {
            // Determine Department Display based on TIER 1 logic
            const rawDeptPart = staff.designation.split(',').pop().trim();
            let deptDisplay = rawDeptPart; 
            
            // Map the raw part to a known canonical name (for cleaner display)
            for (const [key, value] of Object.entries(DEPT_MAP)) {
                if (rawDeptPart.toLowerCase().includes(key)) {
                    deptDisplay = value;
                    break;
                }
            }
            // Further clean up display string
            if (deptDisplay.includes('Main Dept Line')) deptDisplay = deptDisplay.replace('HOD/', '').replace('Main Dept Line', 'Main Office Line');
            if (deptDisplay.toUpperCase() === 'SECURITY STAFF') deptDisplay = 'MAINTENANCE / SECURITY';
            
            // Handle specific CSE designations for display clarity
            if (staff.designation.includes('CSE (AI&ML)')) deptDisplay = 'CSE (AI&ML)';
            if (staff.designation.includes('CSE (DS)')) deptDisplay = 'CSE (DS)';
            if (staff.designation.includes('CSE (AI)')) deptDisplay = 'CSE (AI)';

            const number = staff.number || "Not Provided";
            
            let block = `**Name:** ${staff.name}\n`;
            block += `**Designation:** ${staff.designation}\n`;
            block += `**Department:** ${deptDisplay.toUpperCase()}\n`;
            block += `**Contact Number:** ${number}`;
            return block;
        };

        // 1. Single Match Logic
        if (uniqueFinalMatches.length === 1) {
            const singleMatch = uniqueFinalMatches[0];
            let response = `📇 **Staff Contact Information:**\n\n`;
            response += formatContactBlock(singleMatch);
            response += `\n\n_For further assistance, please feel free to ask about any other staff member._`;
            return response;
        }
        
        // 2. Multiple Matches Logic
        if (uniqueFinalMatches.length > 1) {
            
            let response = `📋 **Matching Staff Members:**\n\n`;
            
            uniqueFinalMatches.slice(0, 5).forEach((staff, index) => {
                response += `${index + 1}️⃣\n`;
                response += formatContactBlock(staff);
                response += `\n\n`;
            });
            
            if (uniqueFinalMatches.length > 5) {
                response += `(Plus ${uniqueFinalMatches.length - 5} more results. Please refine your search.)\n\n`;
            }
            
            response += `_For further assistance, please feel free to ask about any other staff member._`;
            return response.trim();
        }

        // 3. Fallback to the mandatory user rule for final fallback
        return `No matching staff found. Please check spelling or provide department.`; 
    };
    // --- END STAFF CONTACTS LOGIC ---

    // --- GEMINI API CONFIGURATION ---
    // CORRECTED TYPO in generativelanguage
    const API_KEY = "AIzaSyD0VriKBX6ekEN-hi6WM9VTuFrlxacGIqc"; // Place your actual API Key here
    const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${API_KEY}`;
    
    // --- KNOWLEDGE BASE FROM PRAGATI.AC.IN (Hardcoded stable links) ---
    const KNOWLEDGE_BASE = `
--- Pragati Engineering College Official Data ---
1. Accreditation: Approved by AICTE, Accredited by NBA, Accredited by NAAC with A+ Grade.
2. Courses Offered (Departments): Electronics and Communication Engineering (ECE), Computer Science and Engineering (CSE), Mechanical Engineering (ME), Electrical and Electronics Engineering (EEE), Information Technology (IT), Civil Engineering, CSE (Data Science), CSE (Artificial Intelligence & Machine Learning), CSE (Artificial Intelligence), CSE (Cyber Security), Basic Sciences and Humanities (BS&H). M.Tech programs are also available in CSE, PE&ED, VLSI, and CAD CAM.
3. Admission Criteria (UG): Minimum 50% marks in Intermediate/10+2. Admission is primarily based on the Common Entrance Test EAPCET rank.
4. College Codes: EAPCET & ECET Code: PRAG. PGCET Code: PRAG1.
5. Placements (2025 as of May 31): Total 1625 placements. Highest Package: 40 LPA. Other notable packages: 29 LPA, 11 LPA, 6 LPA, 5.50 LPA, 3.60 LPA, 3.36-9.0 LPA.
6. Contact Information (General): Address: 1-378, ADB Road, Surampalem, Near Peddapuram, Kakinada.Dist, A.P. (Pin 533437). Email: pragati@pragati.ac.in. Phone: +91 7330826667, 08852 252233.
7. **Official Website Link (Home):** <a href="https://pragati.ac.in/" target="_blank">Pragati Engineering College Official Website</a>
8. **Admissions Page Link:** <a href="https://pragati.ac.in/admissions/" target="_blank">Official Admissions Page</a>
9. **Syllabus & Academic Documents Link:** <a href="https://pragati.ac.in/examination/course-structure-syllabus/" target="_blank">Download Syllabus & Academic Regulations PDF (Click Here to Select)</a>
10. **Academic Calendars Link:** <a href="https://pragati.ac.in/examinations/academic-calendars/" target="_blank">Download Latest Academic Calendars PDF (Click Here to Select)</a>
11. **Fee & Circulars Link:** <a href="https://pragati.ac.in/admissions/" target="_blank">View Admissions and Fee Details/Circulars</a>
12. Academics: Every semester has a minimum of eight courses, including two labs. Four-year duration.
13. Campus Life/Clubs: Features include Technical, Cultural, Literary, and Industrial Clubs, Sports (Basketball, Volleyball, Cricket, Gym), and SWAYAM NPTEL Local Chapter.
14. **Previous Question Papers Link:** <a href="https://pragati.ac.in/examination/previous-question-papers/" target="_blank">Download Previous Year Question Papers (Click Here to Select)</a>
15. **Campus Timings & Canteen:** The College Canteen is available on campus. Lunch timings are split: 1:00 PM to 1:30 PM for First-Year students, and 12:00 PM to 12:30 PM for Second-Year to Final-Year students.
16. **Annual B.Tech Tuition Fee (Convener Quota):** The approved annual tuition fee for all B.Tech courses (EAPCET/Convener Quota) is **₹77,800**.
--- End of Data ---
`;

    // System instruction defines the bot's persona and rules.
    const SYSTEM_PROMPT = KNOWLEDGE_BASE + `
You are the 'Pragati Engineering College Insight Bot'. Your persona is that of a **friendly, knowledgeable, and slightly witty senior student** at **Pragati Engineering College, Surampalem (Autonomous)**. Your primary goal is to provide accurate, specific, and professional information only about this college in an engaging and helpful tone.

**Tone and Style:**
* Be enthusiastic, supportive, and use appropriate emojis (like 👍, 🤩, 🎓, ✨, etc.) to make the conversation fun and interactional.
* Use contractions and maintain a conversational flow.
* Your responses must be concise and directly address the new student's questions regarding faculty, studies, packages, labs, head members, and examinations.

**Formatting Rules for Neat Responses (CRITICAL):**
* You MUST wrap any structured output (lists, cards, multiple links, or multi-point answers) in a **single outer <div> with the class \`info-card\`** to ensure proper HTML rendering and professional appearance.
* **DO NOT** use Markdown bullet points (*, -, +). When listing items, you MUST use standard HTML unordered lists (\`<ul>\` and \`<li>\`).
* For **overviews (accreditation, courses, admission)**, structure the response using HTML unordered lists (\`<ul>\` and \`<li>\`) and classes like \`info-item\`. Ensure each department or long item is listed on a separate \`<li>\` item to prevent text overflow. Use emojis like ✅, 🎓, 📞, 📍, and 🔗 to act as "pictorial" elements to break up the text and categorize information clearly.
* For **lists of links (Syllabus/M.Tech regulations)**, clearly list them using the \`link-list\` class. **For all syllabus, academic calendar, or regulations requests, provide only the stable main links found in data points 9, 10, and 14.** * When providing the syllabus or academic calendar link, you must add the following **single, concise** instruction: "👉 **Click the link, then select the specific Regulation (R23/R20) and Year (I, II, III, IV) you need to download your PDF.**"
* Responses must be concise. Use **bold text** for male.

**Knowledge Access Rules:**
1.  **Special Rule (Contact Data):** The user's request for a specific **name, phone number, or department main line** will be handled by the local \`findStaffContact()\` function. If the user asks for a contact or number, do NOT try to answer; rely on the search function.
2.  **Special Rule (Placement Graph):** If the user asks for a **comparison, trend, or graph** regarding placement packages, you MUST respond with the exact phrase: "**I'd be happy to show you the trend!**" and then call the \`showPlacementGraph()\` JavaScript function.
3.  **Prioritize Hardcoded Data:** Use the exact links and contact details provided in the 'Pragati Engineering College Official Data' immediately upon request.
4.  **User Typo/Grammar Correction:** You must apply a high degree of tolerance for user misspellings, typos, and poor grammar. Always infer the intended query about Pragati Engineering College.
5.  **Use Google Search Grounding:** For questions about **latest news, current placements (beyond the hardcoded list), or real-time circulars/notifications**, use the Google Search tool to find the most current information, ensuring the results are strictly limited to **Pragati Engineering College, Surampalem**. Use **🧑‍🏫** (Professor icon) next to any faculty/staff name and **💰** next to any placement package amount to make the response visually engaging.
6.  **Out-of-Scope Queries:** If a query is NOT about Pragati Engineering College or its associated topics (academics, admissions, staff, placements, etc.), you MUST use the exact phrase: "**I am the Pragati Engineering College Insight Bot, and that query is out of my knowledge scope.**" Do not search the web or provide general knowledge answers for any other topic.

**Crucial Custom Instruction:** When a user asks to call 'Akka', you must provide the phone number: **79899 3489**.
`;

    // --- DOM ELEMENTS AND UTILITIES ---
    const chatHistory = document.getElementById('chat-history');
    const userInput = document.getElementById('user-input');
    const sendButton = document.getElementById('send-button');
    const voiceButton = document.getElementById('voice-button');
    const loginView = document.getElementById('login-view');
    const chatView = document.getElementById('chat-view');
    const suggestionArea = document.getElementById('suggestion-area'); // Restored element

    let chatInitialized = false;
    let recognition = null;
    let currentMessageElement = null; // Used to hold the loading message element
    let placementChart = null; // Variable to hold the Chart.js instance

    // --- NEW DARK MODE LOGIC ---
    const modeToggle = document.getElementById('mode-toggle');
    const sunIcon = document.getElementById('sun-icon');
    const moonIcon = document.getElementById('moon-icon');

    const setMode = (isDark) => {
        if (isDark) {
            document.body.classList.add('dark');
            if (moonIcon) moonIcon.classList.add('hidden');
            if (sunIcon) sunIcon.classList.remove('hidden');
            localStorage.setItem('theme', 'dark');
        } else {
            document.body.classList.remove('dark');
            if (moonIcon) moonIcon.classList.remove('hidden');
            if (sunIcon) sunIcon.classList.add('hidden');
            localStorage.setItem('theme', 'light');
        }
        // Destroy and re-render chart to apply theme colors if it exists
        if (placementChart) {
            const tempQuery = 'Check Placement Trend';
            // We need to trigger the graph function again to redraw with new theme.
            // A simple message simulates the call to keep logic flow centralized.
            sendMessage(tempQuery, false); // Sends command silently
        }
    };

    const toggleDarkMode = () => {
        const isDark = document.body.classList.contains('dark');
        setMode(!isDark);
    };

    const applySavedTheme = () => {
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'dark' || (!savedTheme && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            setMode(true);
        } else {
            setMode(false);
        }
    };
    // --- END DARK MODE LOGIC ---


    // Scroll chat to the bottom
    const scrollToBottom = () => {
        chatHistory.scrollTop = chatHistory.scrollHeight;
    };

    // Add message to chat history
    const addMessage = (content, isUser) => {
        const messageDiv = document.createElement('div');
        messageDiv.className = `flex flex-col ${isUser ? 'items-end' : 'items-start'} mb-2`;
        
        const bubble = document.createElement('div');
        bubble.className = `message-bubble ${isUser ? 'user-message' : 'bot-message'}`;
        bubble.innerHTML = content; 

        messageDiv.appendChild(bubble);
        chatHistory.appendChild(messageDiv);
        scrollToBottom();

        // If it's a bot message, store it for the final response
        if (!isUser) {
            currentMessageElement = bubble;
            // Add a temporary class for the pop-in effect and remove after it finishes
            bubble.classList.add('animate-pop-in');
            setTimeout(() => {
                bubble.classList.remove('animate-pop-in');
            }, 300);
        }
    };

    // Add typing indicator
    const showTyping = () => {
        const loadingDiv = document.createElement('div');
        loadingDiv.id = 'loading-indicator';
        loadingDiv.className = 'flex flex-col items-start mb-2';
        
        // Show the Thinking Icon structure
        loadingDiv.innerHTML = `
            <div class="bot-message message-bubble flex items-center justify-center">
                <span class="thinking-icon" style="font-size: 1.5rem;">⏳</span>
            </div>
        `;
        chatHistory.appendChild(loadingDiv);
        scrollToBottom();
        
        // Update the placeholder text
        userInput.placeholder = "Your senior is thinking... 🧠";
    };

    // Remove typing indicator
    const hideLoading = () => {
        const loadingDiv = document.getElementById('loading-indicator');
        if (loadingDiv) {
            loadingDiv.remove();
        }
        // Reset the placeholder text
        userInput.placeholder = "Ask a question...";
    };

    // --- SUGGESTION LOGIC (Restored) ---
    const clearSuggestions = () => {
        suggestionArea.innerHTML = '';
        suggestionArea.style.paddingTop = '0';
        suggestionArea.style.paddingBottom = '0';
        suggestionArea.classList.remove('p-3');
        suggestionArea.style.height = '0';
    };

    const showSuggestions = (suggestions) => {
        clearSuggestions();
        if (!suggestions || suggestions.length === 0) return;

        suggestions.forEach(text => {
            const button = document.createElement('button');
            button.className = 'suggestion-button button-click-animation';
            button.textContent = text;
            button.onclick = () => {
                userInput.value = text;
                sendMessage();
            };
            suggestionArea.appendChild(button);
        });
        
        // Apply responsive padding and height for visibility
        suggestionArea.classList.add('p-3');
        suggestionArea.style.height = 'auto'; 
        scrollToBottom();
    };
    // --- END SUGGESTION LOGIC ---
    
    // --- CHART.JS RENDERING FUNCTION ---
    const showPlacementGraph = () => {
        // 1. Add chat confirmation message
        if (placementChart) {
            // If chart exists, destroy it before trying to find the element wrapper.
            // Also, skip the confirmation message to prevent spam when redrawing the chart on theme change.
             placementChart.destroy();
        } else {
            addMessage(`I'd be happy to show you the trend! Here's a visual comparison of the Placement trends for the past few years! 📊`, false);
        }
       
        // 2. Create the wrapper div for the chart
        let chartWrapper = chatHistory.querySelector('.chart-wrapper');
        if (!chartWrapper) {
            chartWrapper = document.createElement('div');
            chartWrapper.className = 'bot-message message-bubble chart-wrapper flex flex-col items-start info-card w-full max-w-full';
        } else {
             chartWrapper.innerHTML = ''; // Clear previous content if redrawing
             chartWrapper.classList.remove('hidden');
        }
        
        // 3. Add the canvas element
        const canvas = document.createElement('canvas');
        canvas.id = 'placementChart';
        chartWrapper.appendChild(canvas);
        
        // 4. Create the summary text area
        const summaryDiv = document.createElement('div');
        summaryDiv.className = 'graph-summary';
        
        // Calculate dynamic summary points
        const latestHighest = PLACEMENT_DATA.highest[PLACEMENT_DATA.highest.length - 1];
        const latestAverage = PLACEMENT_DATA.average[PLACEMENT_DATA.average.length - 1];
        const firstHighest = PLACEMENT_DATA.highest[0];
        const highestGrowth = ((latestHighest - firstHighest) / firstHighest * 100).toFixed(0);
        // Calculate average growth based on the latest year vs previous year
        const prevAverage = PLACEMENT_DATA.average[PLACEMENT_DATA.average.length - 2];
        const averageGrowth = ((latestAverage - prevAverage) / prevAverage * 100).toFixed(0); 

        summaryDiv.innerHTML = `
            <h4 class="font-bold text-lg mb-2 text-gray-800">Key Trends (2022 - 2025):</h4>
            <p>✅ **Highest Package:** The peak package has shown strong growth, climbing from **${firstHighest} LPA in ${PLACEMENT_DATA.years[0]}** to a current high of **${latestHighest} LPA** (a massive **${highestGrowth}% growth**).</p>
            <p>📈 **Average Package Trend:** The average package has maintained a steady upward trend, reaching **${latestAverage} LPA** in the ongoing ${PLACEMENT_DATA.years[PLACEMENT_DATA.years.length - 1]} batch. This is an increase of **${averageGrowth}%** over the previous year!</p>
            <p>🚀 **Action:** These numbers indicate a strong focus on high-value placements, especially in specialized IT and CSE roles. Make sure to attend the **Career Development Cell** workshops! 🎓</p>
        `;
        
        chartWrapper.appendChild(summaryDiv);
        
        chatHistory.appendChild(chartWrapper);
        scrollToBottom();

        // 5. Render the chart
        
        const isDark = document.body.classList.contains('dark');
        const textColor = isDark ? '#e0e0e0' : '#333';
        const gridColor = isDark ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';
        const tealColor = isDark ? 'rgba(0, 201, 167, 0.8)' : 'rgba(0, 201, 167, 0.8)';
        const deepBlueColor = isDark ? 'rgba(0, 100, 148, 0.8)' : 'rgba(0, 100, 148, 0.8)';

        placementChart = new Chart(canvas, {
            type: 'bar',
            data: {
                labels: PLACEMENT_DATA.years,
                datasets: [
                    {
                        label: 'Highest Package (LPA)',
                        data: PLACEMENT_DATA.highest,
                        backgroundColor: tealColor,
                        borderColor: tealColor.replace('0.8', '1'),
                        borderWidth: 1,
                        yAxisID: 'y'
                    },
                    {
                        label: 'Average Package (LPA)',
                        data: PLACEMENT_DATA.average,
                        backgroundColor: deepBlueColor,
                        borderColor: deepBlueColor.replace('0.8', '1'),
                        borderWidth: 1,
                        yAxisID: 'y'
                    }
                ]
            },
            options: {
                responsive: true,
                plugins: {
                    title: {
                        display: true,
                        text: 'Placement Package Trends (LPA)',
                        font: { size: 16, weight: 'bold' },
                        color: textColor
                    },
                    legend: {
                        position: 'top',
                        labels: {
                            color: textColor // Set legend text color
                        }
                    }
                },
                scales: {
                    x: {
                        grid: { display: false },
                        ticks: { color: textColor }
                    },
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Package in LPA',
                            color: textColor
                        },
                        ticks: { color: textColor },
                        grid: { color: gridColor }
                    }
                }
            }
        });
    };
    
    // --- VOICE INPUT LOGIC ---

    const startVoiceInput = () => {
        if (!('webkitSpeechRecognition' in window)) {
            addMessage("❌ **Error:** Speech recognition is not supported in this browser. Please use Chrome or a Chromium-based browser.", false);
            return;
        }

        if (recognition && recognition.running) {
            recognition.stop();
            return;
        }
        
        // Initialize Speech Recognition API
        recognition = new webkitSpeechRecognition();
        recognition.continuous = false;
        recognition.interimResults = false;
        recognition.lang = 'en-US';
        recognition.maxAlternatives = 1;

        recognition.onstart = () => {
            voiceButton.classList.add('mic-active');
            voiceButton.disabled = false; // Enable the button to allow stopping
            sendButton.disabled = true;
            userInput.placeholder = "👂 Listening... Speak now!";
        };

        recognition.onresult = (event) => {
            const transcript = event.results[0][0].transcript;
            userInput.value = transcript;
            // The logic below will send the message automatically when speech stops
            recognition.stop();
        };

        recognition.onerror = (event) => {
            console.error('Speech recognition error:', event.error);
            // Hide the error message from the chat, just print to console for debugging
            recognition.stop();
        };

        recognition.onend = () => {
            voiceButton.classList.remove('mic-active');
            sendButton.disabled = false;
            userInput.placeholder = "Ask a question...";

            // Automatically send the transcribed text if available
            if (userInput.value.trim().length > 0) {
                sendMessage();
            }
        };

        try {
            recognition.start();
        } catch (e) {
             // Catch error if speech recognition is already active (rare)
            console.error("Speech recognition start error:", e);
        }
    };

    // --- VIEW MANAGEMENT & ENTRY ---
    const showView = (viewId) => {
        if (viewId === 'login') {
            loginView.style.display = 'flex';
            chatView.style.display = 'none';
        } else {
            loginView.style.display = 'none';
            chatView.style.display = 'flex';
        }
    };

    const initializeChat = () => {
        if (!chatInitialized) {
            // Add the initial welcome message only once
            addMessage("Hello! I'm the **Pragati Engineering College Insight Bot**. I am an official assistant ready to help you with questions about admissions, courses (B.Tech/M.Tech), campus life, and more, specific to our Surampalem campus. How can I assist you? ✨", false);
            
            // Show initial suggestions
            showSuggestions([
                "What courses are offered?",
                "Check Placement Trend",
                "Who is the Principal?"
            ]);

            chatInitialized = true;
        }
        userInput.focus();
    };

    const startChat = () => {
        showView('chat');
        initializeChat();
    };

    // Attach 'Enter' key listeners to the document (will be ignored if the input is disabled)
    const handleKeypress = (e) => {
        if (e.key === 'Enter') {
            // If the chat view is active, try to send a message
            if (chatView.style.display === 'flex' && !sendButton.disabled) {
                sendMessage();
            } 
            // If the login view is active, trigger the chat start
            else if (loginView.style.display === 'flex') {
                startChat();
            }
        }
    };

    // --- API CALL LOGIC WITH EXPONENTIAL BACKOFF ---

    const fetchGeminiResponse = async (contents, maxRetries = 3, delay = 500) => { // Reduced retries to 3 and delay to 500ms
        const payload = {
            contents: contents,
            systemInstruction: {
                parts: [{ text: SYSTEM_PROMPT }]
            },
            // --- ADDING GOOGLE SEARCH GROUNDING ---
            tools: [{ "google_search": {} }],
            // -------------------------------------
        };

        for (let i = 0; i < maxRetries; i++) {
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (response.ok) {
                    return await response.json();
                } else if (response.status === 429 || response.status >= 500) {
                    console.warn(`API call failed (Status: ${response.status}). Retrying in ${delay / 1000}s...`);
                    await new Promise(resolve => setTimeout(resolve, delay));
                    delay *= 1.5; // Slightly less aggressive backoff
                } else {
                    throw new Error(`API call failed with status: ${response.status}`);
                }
            } catch (error) {
                if (i === maxRetries - 1) {
                    console.error("Gemini API call failed after multiple retries:", error);
                    throw new Error("I apologize, but I couldn't connect to the server. Please try again later.");
                }
                await new Promise(resolve => setTimeout(resolve, delay));
                delay *= 1.5;
            }
        }
    };

    // --- MAIN CHAT FUNCTIONALITY ---
    const sendMessage = async (input, userInitiated = true) => {
        const messageText = input || userInput.value.trim();
        
        if (!messageText) return;

        if (userInitiated) {
            userInput.value = '';
            sendButton.disabled = true;
            voiceButton.disabled = true;
            addMessage(messageText, true);
        }

        // Clear previous suggestions immediately
        clearSuggestions(); 
        
        // --- NEW: Keyword Check for Contact Queries ---
        const contactKeywords = /(call|number|phone|contact|line|hod|principal|dean|warden|discip|officer)/i;
        const isContactQuery = contactKeywords.test(messageText) || /(professor|technician|admin|assistant)/i.test(messageText);
        
        // --- NEW: Keyword Check for Graph Queries (FIX) ---
        const graphKeywords = /(graph|chart|comparison|trend|package|salary|placement)/i;
        const isGraphQuery = graphKeywords.test(messageText);

        try {
            // --- 1. GRAPH CHECK (INSTANT RESPONSE) ---
            if (isGraphQuery) {
                 hideLoading();
                 showPlacementGraph();
                 
                 // After graph, suggest next steps
                 showSuggestions([
                    "Tell me the highest package", 
                    "What courses are offered?",
                    "Contact the CDC Dean"
                 ]);
                 return; // Stop here, graph is shown
            }

            // --- 2. CONTACTS CHECK (INSTANT RESPONSE) ---
            if (isContactQuery) {
                const localContactResponse = findStaffContact(messageText);
                
                if (localContactResponse && localContactResponse !== `No matching staff found. Please check spelling or provide department.`) {
                    hideLoading();
                    addMessage(localContactResponse, false);

                    if (localContactResponse.startsWith("📋 **Matching Staff Members:**")) {
                        // Ambiguous query: Suggest refining by department
                        showSuggestions([
                            "Contact ECE HOD",
                            "Contact CSE HOD",
                            "Contact the Principal"
                        ]);
                    } else {
                        // Successful single match: Suggest related queries
                        showSuggestions([
                            "What is the college fee?",
                            "Where can I find the syllabus?",
                            "Check canteen timings"
                        ]);
                    }
                    return; // Contact found locally, skip AI search
                } else if (localContactResponse === `No matching staff found. Please check spelling or provide department.`) {
                    // If local search fails for contacts, display the message, then continue to AI for general help.
                    // This prevents re-running the AI only to get an out-of-scope response.
                    hideLoading();
                    addMessage(localContactResponse, false);
                    showSuggestions([
                        "Contact the Principal",
                        "Who is the HOD for ECE?",
                        "Check General Contact Info"
                    ]);
                    return;
                }
            }
            // --- END LOCAL CONTACTS CHECK ---

            const contents = [{ role: "user", parts: [{ text: messageText }] }];
            showTyping(); // Show typing indicator and update placeholder

            const result = await fetchGeminiResponse(contents);
            
            const botResponse = result.candidates?.[0]?.content?.parts?.[0]?.text;
            
            if (botResponse) {
                // 1. Check for the special command to trigger the graph (Old/Backup Check - should not be needed)
                if (botResponse.startsWith("I'd be happy to show you the trend!")) {
                    hideLoading();
                    addMessage(botResponse.replace("I'd be happy to show you the trend!", "I'd be happy to show you the trend! 🚀"), false);
                    showPlacementGraph();
                    // Suggestions handled by graph block above
                    return; 
                }
                
                // 2. If it's a normal message: Hide the typing indicator and reset placeholder
                hideLoading();

                // 3. Add the final message (will trigger the pop-in animation)
                addMessage(botResponse, false); 
                
                // 4. Show contextual suggestions based on AI response
                const responseLower = botResponse.toLowerCase();
                if (responseLower.includes('syllabus') || responseLower.includes('academic calendar') || responseLower.includes('documents')) {
                    showSuggestions([
                        "Download Previous Papers",
                        "What are the admission criteria?",
                        "Check Placement Trend"
                    ]);
                } else if (responseLower.includes('accredited') || responseLower.includes('courses') || responseLower.includes('department')) {
                    showSuggestions([
                        "Tell me the B.Tech fee",
                        "What are the M.Tech courses?",
                        "Where is the campus located?"
                    ]);
                } else if (botResponse.includes('I am the Pragati Engineering College Insight Bot, and that query is out of my knowledge scope.')) {
                    showSuggestions([
                        "What can you help me with?",
                        "What courses are offered?",
                        "Contact the Principal"
                    ]);
                } else {
                    showSuggestions([
                        "What is the college fee?",
                        "Where can I find the syllabus?",
                        "Check Placement Trend"
                    ]);
                }

            } else {
                hideLoading();
                // This generic fallback is kept just in case the API call fails entirely
                addMessage("Oops! I hit a snag while looking that up. Please try again or rephrase your question. 🤔", false);
                // Fallback suggestions
                showSuggestions([
                    "What courses are offered?",
                    "Contact General Office",
                    "Check Placement Trend"
                ]);
            }

        } catch (error) {
            console.error("Chat Error:", error);
            hideLoading();
            // --- UPDATED ERROR MESSAGE FOR PROFESSIONAL TONE ---
            addMessage(`I am unable to connect to the external information source right now. Please try again in a moment.`, false);
            // ----------------------------------------------------
        } finally {
            sendButton.disabled = false;
            voiceButton.disabled = false;
            userInput.focus();
            scrollToBottom();
        }
    };

    // --- INITIALIZATION ---
    window.onload = () => {
        applySavedTheme(); // Apply theme before showing view
        showView('login');
        document.addEventListener('keypress', handleKeypress);
    };

</script>
</body>
</html>
